---
- hosts: base.local
#  become: yes
  tasks: 
  - name: "install lxc"
    become: yes
    apt: name={{item}} update_cache=yes cache_valid_time=3600
    with_items:
      - lxc
      - python-lxc
      - python-dev
      - debootstrap
      - libvirt0
      - libpam-cgroup
      - libpam-cgfs
      - bridge-utils
  - name: "create bridge"
    become: yes
    shell: brctl addbr br0
  - name: "setting bridge"
    become: yes
    shell: sh -c 'echo "auto br0\niface br0 inet dhcp\n      bridge_ports enp2s0f2\n      bridge_stp off\n      bridge_maxwait 0" >> /etc/network/interfaces'
  - name: "Restart service networking"
    service:
      name: networking.service
      become: yes
      state: restarted
  - name: "setting lxc-default configuration"
    become: yes
    shell: sh -c 'echo "#lxc.network.type = empty\n# architecture configuration\nlxc.arch = amd64\n# Network configuration\nlxc.network.type = veth\nlxc.network.flags = up\nlxc.network.link = br0\nlxc.network.hwaddr = 00:FF:AA:xx:xx:xx" > /etc/lxc/default.conf'
  - name: "setting lxc-net configuration"
    become: yes
    shell: sh -c 'echo USE_LXC_BRIDGE=\"true\" > /etc/default/lxc-net'
  - name: "setting unprivilege user clone configuration"
    become: yes
    shell: sh -c 'echo "kernel.unprivileged_userns_clone=1" > /etc/sysctl.d/80-lxc-userns.conf'
  - name: "setting unprivilege user clone configuration"
    become: yes
    shell: sysctl --system

 
